<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Connector Inventory Search</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    html, body {
      height: 100%;
    }

    /* --- Top Navigation Bar (Matches Inventory UI) --- */

.top-nav {
  width: calc(100% - 48px);
  margin: 16px auto 0 auto;
  padding: 10px 20px;

  background: rgba(255, 255, 255, 0.85);
  border: 1px solid rgba(148, 163, 184, 0.35);
  border-radius: 14px;

  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  display: flex;
  gap: 24px;
  align-items: center;

  box-shadow: 0 10px 28px rgba(15, 23, 42, 0.15);
  position: sticky;
  top: 0;
  z-index: 100;
}

.top-nav .nav-item {
  color: #1e293b;
  text-decoration: none;
  font-size: 0.92rem;
  font-weight: 500;

  padding: 6px 10px;
  border-radius: 8px;

  transition: all 0.2s ease;
}

/* Hover effect */
.top-nav .nav-item:hover {
  background: #e0edff;
  color: #1d4ed8;
}

/* Active page highlight */
.top-nav .nav-item.active {
  background: #dbeafe;
  color: #1d4ed8;
  font-weight: 600;
  border: 1px solid #93c5fd;
  box-shadow: 0 2px 6px rgba(37, 99, 235, 0.25);
}


    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top left, #e0edff 0, #f5f7fb 45%,
        #ffffff 100%);
      color: #0f172a;
    }

    /* Main layout: sidebar + content, centered with ~1400px max width */
    .page {
      max-width: 1400px;
      margin: 24px auto;
      padding: 0 12px;
      flex: 1;
      display: flex;
      gap: 12px;
      min-height: calc(100vh - 48px);
    }

    /* Left filter panel (~150px) */
    .filters-panel {
      flex: 0 0 150px;
      max-width: 160px;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 14px 35px rgba(15, 23, 42, 0.12);
      padding: 10px 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 0.78rem;
    }

    .filters-title {
      font-size: 0.82rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #6b7280;
      margin-bottom: 4px;
    }

    .filters-section-separator {
      height: 1px;
      background: #e5e7eb;
      margin: 4px 0;
    }

    .filters-footer {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    /* Right main card (table, header, pager) */
    .card {
      background: rgba(255, 255, 255, 0.98);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.12);
      padding: 16px 20px;
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
      min-width: 0;
      min-height: 0;
    }

    .card-header {
      display: flex; justify-content: space-between; align-items: baseline;
      gap: 12px; margin-bottom: 10px;
      flex: 0 0 auto;
    }

    .card-header h1 { font-size: 1.35rem; margin: 0; letter-spacing: 0.03em; }
    .card-header span {
      font-size: 0.78rem; color: #6b7280; text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .header-left {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.title-row {
  display: flex;
  align-items: center;
  gap: 18px;
  flex-wrap: wrap;
}

.header-meta {
  font-size: 0.8rem;
  color: #6b7280;
  white-space: nowrap;
}

/* --- Inline Page Tabs Beside the Title --- */

.page-tabs {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.tab {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 0.8rem;
  font-weight: 500;
  text-decoration: none;

  background: #f9fafb;
  color: #374151;
  border: 1px solid rgba(148, 163, 184, 0.5);

  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.07);
  transition: background .15s ease, color .15s ease, 
              border-color .15s ease, box-shadow .15s ease;
}

.tab:hover {
  background: #e0edff;
  color: #1d4ed8;
  border-color: #93c5fd;
  box-shadow: 0 6px 14px rgba(37, 99, 235, 0.18);
}

.tab.active {
  background: #dbeafe;
  color: #1d4ed8;
  border-color: #60a5fa;
  box-shadow: 0 6px 16px rgba(37, 99, 235, 0.25);
}


    /* Fields / inputs in sidebar */
    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.78rem;
      position: relative;
    }
    .field label { font-weight: 500; color: #4b5563; }

    .field input {
      border-radius: 999px; border: 1px solid #cbd5e1;
      padding: 5px 9px; font-size: 0.78rem; outline: none;
      background: #f9fafb;
      transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
      width: 100%;
      max-width: 100%;
    }
    .field input:focus {
      border-color: #2563eb; background: #ffffff;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.3);
    }

    .search-wrapper { position: relative; }
    .search-wrapper input { padding-right: 22px; }
    .clear-btn {
      position: absolute; right: 6px; top: 50%; transform: translateY(-50%);
      border: none; background: transparent; font-size: 13px;
      cursor: pointer; color: #9ca3af; padding: 0; line-height: 1;
    }
    .clear-btn:hover { color: #6b7280; }

    /* Custom multi-select */
    .multi-select {
      border-radius: 999px;
      border: 1px solid #cbd5e1;
      padding: 5px 9px;
      font-size: 0.78rem;
      background: #f9fafb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
      width: 100%;
      max-width: 100%;
    }

    .multi-select.open {
      border-color: #2563eb;
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.3);
    }

    .multi-select.active {
      border-color: #2563eb;
      background: #eff6ff;
    }

    .multi-select-label {
      color: #111827;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      font-size: 0.76rem;
    }

    .multi-select-placeholder {
      color: #9ca3af;
    }

    .multi-select-caret {
      margin-left: 4px;
      font-size: 0.65rem;
      color: #6b7280;
    }

    .multi-select-menu {
      position: absolute;
      left: 0;
      right: 0;
      top: 100%;
      margin-top: 4px;
      z-index: 10;
      background: #ffffff;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 14px 35px rgba(15, 23, 42, 0.18);
      max-height: 260px;
      overflow-y: auto;
      padding: 0;
      display: none;
    }

    .multi-select-menu.open {
      display: block;
    }

    .multi-select-menu-header {
      padding: 4px 10px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: flex-end;
      background: #f9fafb;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .multi-select-clear {
      border: none;
      background: none;
      font-size: 0.75rem;
      color: #2563eb;
      cursor: pointer;
      text-decoration: underline;
      padding: 0;
    }

    .multi-select-menu label {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      font-size: 0.78rem;
      cursor: pointer;
      white-space: nowrap;
    }

    .multi-select-menu label:hover {
      background: #eff6ff;
    }

    .multi-select-menu input[type="checkbox"] {
      width: 13px;
      height: 13px;
      cursor: pointer;
    }

    .tiny-check {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      color: #4b5563;
      white-space: nowrap;
    }
    .tiny-check input {
      width: 12px;
      height: 12px;
      margin: 0;
    }

    .stock-select {
      border-radius: 999px;
      border: 1px solid #cbd5e1;
      padding: 3px 8px;
      font-size: 0.75rem;
      background: #ffffff;
      width: 100%;
    }

    /* Toolbar repurposed as part of sidebar footer */
    .toolbar {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
      font-size: 0.78rem;
      color: #6b7280;
      flex: 0 0 auto;
      margin: 0;
    }

    .toolbar-right {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      width: 100%;
    }

    .toolbar button {
      border-radius: 999px; border: none; padding: 5px 10px;
      font-size: 0.78rem; cursor: pointer; background: #0f172a; color: #f9fafb;
      display: inline-flex; align-items: center; gap: 6px;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.25);
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
      width: 100%;
      justify-content: center;
    }
    .toolbar button:hover {
      background: #111827; transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.3);
    }

    /* Action bar */
    .action-bar {
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 6px 10px;
      margin-bottom: 8px;
      border-radius: 999px;
      background: #eff6ff;
      font-size: 0.8rem;
      flex: 0 0 auto;
      position: relative;
    }
    .action-selected {
      font-weight: 500;
      color: #1f2937;
    }
    .action-selected span {
      font-weight: 600;
    }
    .action-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .action-controls label {
      font-weight: 500;
      color: #4b5563;
    }
    .action-controls select {
      border-radius: 999px; border: 1px solid #cbd5e1;
      padding: 4px 10px; font-size: 0.8rem; background: #ffffff;
    }
    .action-controls button {
      border-radius: 999px; border: none;
      padding: 4px 12px; font-size: 0.8rem;
      cursor: pointer; background: #2563eb; color: #f9fafb;
    }
    .action-controls button:hover {
      background: #1d4ed8;
    }
    .action-status {
      min-width: 140px;
      font-size: 0.78rem;
      color: #4b5563;
    }
    .action-close {
      border: none;
      background: transparent;
      font-size: 1rem;
      cursor: pointer;
      color: #6b7280;
      padding: 0 2px;
    }
    .action-close:hover {
      color: #111827;
    }

    /* Pager */
    .pager {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 8px;
      margin: 4px 0 8px;
      font-size: 0.8rem;
      color: #6b7280;
      flex: 0 0 auto;
    }
    .pager button {
      border-radius: 999px;
      border: 1px solid #cbd5e1;
      background: #ffffff;
      padding: 3px 10px;
      font-size: 0.78rem;
      cursor: pointer;
    }
    .pager button:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
    }

    /* Table */
    .table-wrapper {
      border-radius: 12px; border: 1px solid #e5e7eb;
      overflow: hidden; background: #ffffff;
      flex: 1 1 auto;
      min-height: 0;
      overflow-y: auto;
      overflow-x: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
      table-layout: fixed;
    }

    thead { background: #f3f4f6; position: sticky; top: 0; z-index: 1; }

    th, td {
      padding: 6px 6px;
      border-bottom: 1px solid #e5e7eb;
      text-align: center;
      vertical-align: middle;
      white-space: normal;
      overflow: hidden;
      word-wrap: break-word;
      word-break: break-word;
    }

    th {
      font-weight: 600; color: #4b5563; user-select: none;
    }
    th.sortable { cursor: pointer; }
    th.sortable:hover { background: #e5e7eb; }

    tbody tr:nth-child(even):not(.details-row) { background: #f9fafb; }
    tbody tr:hover:not(.details-row):not(.selected-row) {
      background: #e0f2fe;
    }

    .data-row.selected-row {
      background: #dbeafe !important;
      outline: 1px solid #2563eb;
    }

    .tag {
      display: inline-flex; align-items: center; border-radius: 999px;
      border: 1px solid #d1d5db; padding: 1px 6px; font-size: 0.68rem;
      text-transform: uppercase; letter-spacing: 0.06em; background: #f9fafb;
    }

    .qty-pill {
      border-radius: 999px; padding: 1px 8px;
      font-size: 0.7rem; font-variant-numeric: tabular-nums;
      display: inline-block;
    }
    .qty-ok { background: #ecfdf5; color: #047857; }
    .qty-low { background: #fffbeb; color: #92400e; }
    .qty-zero { background: #fef2f2; color: #b91c1c; }

    .muted { color: #9ca3af; font-style: italic; }

    .thumb-img {
      width: 100%;
      max-width: 200px;
      height: 120px;
      border-radius: 10px;
      cursor: pointer;
      object-fit: contain;
      background: #e5e7eb;
      display: block;
      margin: 0 auto;
    }

    .expander {
      cursor: pointer;
      font-size: 0.9rem;
      user-select: none;
      padding-right: 2px;
    }

    .details-row {
      background: #f9fafb;
    }

    .details-cell {
      padding-top: 0;
      padding-bottom: 8px;
    }

    .details-grid {
      margin-top: 4px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
      gap: 4px 12px;
      font-size: 0.75rem;
    }

    .details-term-block {
      border-radius: 10px;
      background: #f3f4f6;
      padding: 6px 8px;
    }

    .details-term-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: #4b5563;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 2px;
    }

    .details-term-main {
      font-size: 0.8rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 2px;
    }

    .details-term-sub {
      font-size: 0.75rem;
      color: #4b5563;
    }

    .shop-cell, .shop-qty {
      background: #eff6ff;
    }
    .van-cell, .van-qty {
      background: #fefce8;
    }

    /* Column widths tuned for ~1250px table area */
    thead th:nth-child(1),
    tbody td:nth-child(1) { width: 24px; max-width: 24px; }   /* expander */
    thead th:nth-child(2),
    tbody td:nth-child(2) { width: 215px; max-width: 215px; } /* Pic */
    thead th:nth-child(3),
    tbody td:nth-child(3) { width: 130px; max-width: 130px; } /* Part # */
    thead th:nth-child(4),
    tbody td:nth-child(4) { width: 200px; max-width: 200px; } /* Desc */
    thead th:nth-child(5),
    tbody td:nth-child(5) { width: 60px; max-width: 60px; }   /* Shop */
    thead th:nth-child(6),
    tbody td:nth-child(6) { width: 40px; max-width: 40px; }   /* Shop Qty */
    thead th:nth-child(7),
    tbody td:nth-child(7) { width: 100px; max-width: 100px; } /* Van */
    thead th:nth-child(8),
    tbody td:nth-child(8) { width: 40px; max-width: 40px; }   /* Van Qty */
    thead th:nth-child(9),
    tbody td:nth-child(9) { width: 40px; max-width: 40px; }   /* Pins */
    thead th:nth-child(10),
    tbody td:nth-child(10) { width: 110px; max-width: 110px; }/* Type */
    thead th:nth-child(11),
    tbody td:nth-child(11) { width: 35px; max-width: 35px; }  /* M/F */
    thead th:nth-child(12),
    tbody td:nth-child(12) { width: 85px; max-width: 85px; }  /* Supplier */

    /* Modals */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal-backdrop.open {
      display: flex;
    }

    .modal-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 14px 18px 16px;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.3);
      width: 100%;
      max-width: 620px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #111827;
    }

    .modal-body {
      flex: 1 1 auto;
      overflow-y: auto;
      padding-right: 4px;
    }

    .modal-footer {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .modal-field {
      display: flex;
      flex-direction: column;
      gap: 3px;
      margin-bottom: 8px;
      font-size: 0.8rem;
    }

    .modal-field label {
      font-weight: 500;
      color: #374151;
    }

    .modal-field input,
    .modal-field textarea {
      border-radius: 10px;
      border: 1px solid #d1d5db;
      padding: 5px 8px;
      font-size: 0.8rem;
      outline: none;
      background: #f9fafb;
    }

    .modal-field input:focus,
    .modal-field textarea:focus {
      border-color: #2563eb;
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.3);
    }

    .modal-hint {
      font-size: 0.7rem;
      color: #6b7280;
    }

    .primary-btn {
      border-radius: 999px;
      border: none;
      padding: 6px 14px;
      font-size: 0.8rem;
      cursor: pointer;
      background: #2563eb;
      color: #f9fafb;
    }

    .primary-btn:hover {
      background: #1d4ed8;
    }

    /* Basic responsive behavior: stack sidebar on narrow screens */
    @media (max-width: 900px) {
      .page {
        flex-direction: column;
      }
      .filters-panel {
        flex: 0 0 auto;
        max-width: 100%;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 8px 10px;
      }
      .filters-footer {
        grid-column: 1 / -1;
      }
    }
  </style>
</head>
<body>

  <nav class="top-nav">
    <a href="/index.html" class="nav-item">Inventory Search</a>
    <a href="/terminal-database.html" class="nav-item">Terminal Database</a>
    <a href="/connector-data.html" class="nav-item">Connector Data</a>
  </nav>

  <div class="page">
    <!-- LEFT FILTER PANEL -->
    <aside class="filters-panel">
      <div class="filters-title">Filters</div>

      <!-- Search -->
      <div class="field">
        <label for="searchInput">Search</label>
        <div class="search-wrapper">
          <input id="searchInput" type="text" placeholder="Part #, desc, alt…" />
          <button type="button" class="clear-btn" id="clearSearchBtn">&times;</button>
        </div>
      </div>

      <!-- Type / Category -->
      <div class="field" data-filter="category">
        <label>Type</label>
        <div class="multi-select" data-filter-toggle="category">
          <span class="multi-select-label multi-select-placeholder" id="categoryLabel">All</span>
          <span class="multi-select-caret">▾</span>
        </div>
        <div class="multi-select-menu" data-filter-menu="category">
          <div class="multi-select-menu-header">
            <button type="button" class="multi-select-clear" data-clear="category">Clear</button>
          </div>
          <label><input type="checkbox" value="connector"> Connector</label>
          <label><input type="checkbox" value="terminal"> Terminal</label>
          <label><input type="checkbox" value="accessory"> Accessory</label>
        </div>
      </div>

      <!-- Pin Count -->
      <div class="field" data-filter="pins">
        <label>Pin Count</label>
        <div class="multi-select" data-filter-toggle="pins">
          <span class="multi-select-label multi-select-placeholder" id="pinsLabel">Any</span>
          <span class="multi-select-caret">▾</span>
        </div>
        <div class="multi-select-menu" data-filter-menu="pins">
          <div class="multi-select-menu-header">
            <button type="button" class="multi-select-clear" data-clear="pins">Clear</button>
          </div>
          <!-- options filled dynamically -->
        </div>
      </div>

      <!-- Gender -->
      <div class="field" data-filter="gender">
        <label>Gender</label>
        <div class="multi-select" data-filter-toggle="gender">
          <span class="multi-select-label multi-select-placeholder" id="genderLabel">Any</span>
          <span class="multi-select-caret">▾</span>
        </div>
        <div class="multi-select-menu" data-filter-menu="gender">
          <div class="multi-select-menu-header">
            <button type="button" class="multi-select-clear" data-clear="gender">Clear</button>
          </div>
          <label><input type="checkbox" value="male"> Male</label>
          <label><input type="checkbox" value="female"> Female</label>
          <label><input type="checkbox" value="m & f"> M & F</label>
        </div>
      </div>

      <!-- Terminal size -->
      <div class="field" data-filter="termSize">
        <label>Terminal Size</label>
        <div class="multi-select" data-filter-toggle="termSize">
          <span class="multi-select-label multi-select-placeholder" id="termSizeLabel">Any</span>
          <span class="multi-select-caret">▾</span>
        </div>
        <div class="multi-select-menu" data-filter-menu="termSize">
          <div class="multi-select-menu-header">
            <button type="button" class="multi-select-clear" data-clear="termSize">Clear</button>
          </div>
          <!-- options filled dynamically -->
        </div>
      </div>

      <!-- Location -->
      <div class="field">
        <label for="locationFilter">Location</label>
        <input id="locationFilter" type="text" placeholder="Tub27, Van Bin…" />
      </div>

      <!-- Supplier -->
      <div class="field" data-filter="manufacturer">
        <label>Supplier</label>
        <div class="multi-select" data-filter-toggle="manufacturer">
          <span class="multi-select-label multi-select-placeholder" id="manufacturerLabel">All</span>
          <span class="multi-select-caret">▾</span>
        </div>
        <div class="multi-select-menu" data-filter-menu="manufacturer">
          <div class="multi-select-menu-header">
            <button type="button" class="multi-select-clear" data-clear="manufacturer">Clear</button>
          </div>
          <!-- options filled dynamically -->
        </div>
      </div>

      <!-- OEM / Vehicle -->
      <div class="field" data-filter="oem">
        <label>Vehicle / OEM</label>
        <div class="multi-select" data-filter-toggle="oem">
          <span class="multi-select-label multi-select-placeholder" id="oemLabel">Any</span>
          <span class="multi-select-caret">▾</span>
        </div>
        <div class="multi-select-menu" data-filter-menu="oem">
          <div class="multi-select-menu-header">
            <button type="button" class="multi-select-clear" data-clear="oem">Clear</button>
          </div>
          <label><input type="checkbox" value="Ford"> Ford</label>
          <label><input type="checkbox" value="GM"> GM</label>
          <label><input type="checkbox" value="Hyundai/Kia"> Hyundai/Kia</label>
          <label><input type="checkbox" value="Nissan"> Nissan</label>
          <label><input type="checkbox" value="Toyota"> Toyota</label>
        </div>
      </div>

      <div class="filters-section-separator"></div>

      <!-- Footer filters / controls -->
      <div class="filters-footer">
        <div class="toolbar">
          <div id="resultsCount">Loading inventory…</div>
          <div class="toolbar-right">
            <label class="tiny-check">
              <input type="checkbox" id="hasPictureFilter" /> Pic only
            </label>
            <label class="tiny-check">
              <input type="checkbox" id="hasTerminalsFilter" /> Term only
            </label>
            <select id="stockFilter" class="stock-select">
              <option value="">All stock</option>
              <option value="shop">Shop &gt; 0</option>
              <option value="van">Van &gt; 0</option>
            </select>
          </div>
        </div>
        <button type="button" id="resetFiltersBtn"><span>↺</span> Reset filters</button>
      </div>
    </aside>

    <!-- RIGHT MAIN CONTENT -->
    <div class="card">
      <div class="card-header">
        <div>
          <h1>Connector Inventory</h1>
          <span>Search · Filter · Locate</span>
        </div>
        <div style="font-size:0.8rem; color:#6b7280;">OnsitePASS · Internal</div>
      </div>

      <!-- Action bar -->
      <div id="actionBar" class="action-bar">
        <div class="action-selected">
          Selected: <span id="selectedPart">(none)</span>
        </div>
        <div class="action-controls">
          <label for="actionSelect">Action</label>
          <select id="actionSelect">
            <option value="">Choose…</option>
            <option value="sendInfo">Send info to OnsitePASS Chat</option>
            <option value="requestConnector">Request this connector</option>
            <option value="copyPart">Copy part #</option>
            <option value="updateInventory">Update Inventory</option>
            <option value="addInventory">Add to Inventory</option>
          </select>
          <button type="button" id="runActionBtn">Go</button>
          <span id="actionStatus" class="action-status"></span>
        </div>
        <button type="button" id="closeActionBarBtn" class="action-close">×</button>
      </div>

      <!-- Request Connector Modal -->
      <div id="requestModal" class="modal-backdrop">
        <div class="modal-card">
          <div class="modal-header">
            <h2>Request this connector</h2>
            <button type="button" id="requestModalClose" class="action-close">×</button>
          </div>
          <div class="modal-body">
            <div class="modal-field">
              <label>Part #</label>
              <input id="requestPartNumber" type="text" readonly />
            </div>
            <div class="modal-field">
              <label>Description</label>
              <input id="requestDescription" type="text" readonly />
            </div>
            <div class="modal-field">
              <label>Requestor</label>
              <input id="requestRequestor" type="text" placeholder="Who is requesting?" />
            </div>
            <div class="modal-field">
              <label>Shop</label>
              <input id="requestShop" type="text" placeholder="Shop name / location" />
            </div>
            <div class="modal-field">
              <label>VIN or Year / Make / Model</label>
              <input id="requestVinOrYmm" type="text" placeholder="17-digit VIN or Y/M/M text" />
              <small id="requestVinHint" class="modal-hint"></small>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" id="requestModalSendBtn" class="primary-btn">Send to Chat</button>
          </div>
        </div>
      </div>

      <!-- Inventory Modal (Update + Add) -->
      <div id="inventoryModal" class="modal-backdrop">
        <div class="modal-card">
          <div class="modal-header">
            <h2 id="inventoryModalTitle">Update Inventory</h2>
            <button type="button" id="inventoryModalClose" class="action-close">×</button>
          </div>
          <div class="modal-body" id="inventoryModalBody">
            <!-- built dynamically -->
          </div>
          <div class="modal-footer">
            <button type="button" id="inventoryModalSaveBtn" class="primary-btn">Save</button>
          </div>
        </div>
      </div>

      <!-- Pager -->
      <div class="pager">
        <button type="button" id="prevPageBtn">‹ Prev</button>
        <span id="pageInfo">Page 1 of 1 · 0 items</span>
        <button type="button" id="nextPageBtn">Next ›</button>
      </div>

      <!-- Table -->
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th></th>
              <th>Pic</th>
              <th class="sortable" data-sort="partNumber">Part #</th>
              <th>Description</th>
              <th>Shop</th>
              <th>Qty</th>
              <th>Van</th>
              <th>Qty</th>
              <th class="sortable" data-sort="pins">Pins</th>
              <th>Type</th>
              <th>M/F</th>
              <th>Supplier</th>
            </tr>
          </thead>

          <tbody id="resultsBody">
            <tr><td colspan="12" class="muted">Loading…</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const DATA_URL = "/.netlify/functions/get-connectors";
    const REQUEST_URL =
      "https://script.google.com/macros/s/AKfycbzQISzKogNh6a9h3x4Ei6nVK2hYRQkUJNpra0YTY4KcrPDeamps-4rAm67NhMId_DAj/exec";
    const STORAGE_KEY = "connectorInventoryFiltersV1";

    const PAGE_SIZE = 100;
    let connectorData = [];
    let filteredData = [];
    let currentPage = 1;
    let currentSort = { key: "partNumber", dir: "asc" };
    let selectedItem = null;
    let openDetailsRow = null;
    let openExpander = null;

    const searchInput = document.getElementById("searchInput");
    const clearSearchBtn = document.getElementById("clearSearchBtn");
    const locationFilter = document.getElementById("locationFilter");
    const resultsBody = document.getElementById("resultsBody");
    const resultsCount = document.getElementById("resultsCount");
    const resetFiltersBtn = document.getElementById("resetFiltersBtn");

    const hasPictureCheckbox = document.getElementById("hasPictureFilter");
    const hasTerminalsCheckbox = document.getElementById("hasTerminalsFilter");
    const stockFilter = document.getElementById("stockFilter");

    const actionBar = document.getElementById("actionBar");
    const selectedPartSpan = document.getElementById("selectedPart");
    const actionSelect = document.getElementById("actionSelect");
    const runActionBtn = document.getElementById("runActionBtn");
    const actionStatus = document.getElementById("actionStatus");
    const closeActionBarBtn = document.getElementById("closeActionBarBtn");

    const categoryLabel = document.getElementById("categoryLabel");
    const pinsLabel = document.getElementById("pinsLabel");
    const genderLabel = document.getElementById("genderLabel");
    const termSizeLabel = document.getElementById("termSizeLabel");
    const manufacturerLabel = document.getElementById("manufacturerLabel");
    const oemLabel = document.getElementById("oemLabel");

    const prevPageBtn = document.getElementById("prevPageBtn");
    const nextPageBtn = document.getElementById("nextPageBtn");
    const pageInfo = document.getElementById("pageInfo");

    // Request modal elements
    const requestModal = document.getElementById("requestModal");
    const requestModalClose = document.getElementById("requestModalClose");
    const requestPartNumberInput = document.getElementById("requestPartNumber");
    const requestDescriptionInput = document.getElementById("requestDescription");
    const requestRequestorInput = document.getElementById("requestRequestor");
    const requestShopInput = document.getElementById("requestShop");
    const requestVinOrYmmInput = document.getElementById("requestVinOrYmm");
    const requestVinHint = document.getElementById("requestVinHint");
    const requestModalSendBtn = document.getElementById("requestModalSendBtn");

    // Inventory modal elements
    const inventoryModal = document.getElementById("inventoryModal");
    const inventoryModalTitle = document.getElementById("inventoryModalTitle");
    const inventoryModalClose = document.getElementById("inventoryModalClose");
    const inventoryModalBody = document.getElementById("inventoryModalBody");
    const inventoryModalSaveBtn = document.getElementById("inventoryModalSaveBtn");

    const multiState = {
      category: new Set(),
      pins: new Set(),
      gender: new Set(),
      termSize: new Set(),
      manufacturer: new Set(),
      oem: new Set()
    };

    function qtyClass(qty) {
      if (qty <= 0) return "qty-zero";
      if (qty <= 3) return "qty-low";
      return "qty-ok";
    }

    function normalize(str) {
      return String(str || "").toLowerCase().replace(/\s+/g, " ").trim();
    }

    function updateMultiLabel(filterName) {
      const set = multiState[filterName];
      let labelEl;
      let placeholderText;

      switch (filterName) {
        case "category":
          labelEl = categoryLabel;
          placeholderText = "All";
          break;
        case "pins":
          labelEl = pinsLabel;
          placeholderText = "Any";
          break;
        case "gender":
          labelEl = genderLabel;
          placeholderText = "Any";
          break;
        case "termSize":
          labelEl = termSizeLabel;
          placeholderText = "Any";
          break;
        case "manufacturer":
          labelEl = manufacturerLabel;
          placeholderText = "All";
          break;
        case "oem":
          labelEl = oemLabel;
          placeholderText = "Any";
          break;
      }

      const toggle =
        document.querySelector(`.multi-select[data-filter-toggle="${filterName}"]`);
      if (!labelEl || !toggle) return;

      if (!set.size) {
        labelEl.textContent = placeholderText;
        labelEl.classList.add("multi-select-placeholder");
        toggle.classList.remove("active");
      } else if (set.size === 1) {
        const val = Array.from(set)[0];
        labelEl.textContent = val;
        labelEl.classList.remove("multi-select-placeholder");
        toggle.classList.add("active");
      } else {
        labelEl.textContent = `${set.size} selected`;
        labelEl.classList.remove("multi-select-placeholder");
        toggle.classList.add("active");
      }
    }

    function saveFilters() {
      try {
        const state = {
          search: searchInput.value || "",
          location: locationFilter.value || "",
          multi: {
            category: Array.from(multiState.category),
            pins: Array.from(multiState.pins),
            gender: Array.from(multiState.gender),
            termSize: Array.from(multiState.termSize),
            manufacturer: Array.from(multiState.manufacturer),
            oem: Array.from(multiState.oem)
          },
          hasPicture: hasPictureCheckbox.checked,
          hasTerminals: hasTerminalsCheckbox.checked,
          stockFilter: stockFilter.value || ""
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        // ignore
      }
    }

    function applyFilters() {
      const search = normalize(searchInput.value);
      const loc = normalize(locationFilter.value);

      const catsSelected = Array.from(multiState.category).map(normalize);
      const pinsSelected = Array.from(multiState.pins);
      const gendersSelected = Array.from(multiState.gender).map(normalize);
      const termSizesSelected = Array.from(multiState.termSize);
      const mfrSelected = Array.from(multiState.manufacturer).map(normalize);
      const oemSelected = Array.from(multiState.oem).map(normalize);

      const hasPic = hasPictureCheckbox.checked;
      const hasTerm = hasTerminalsCheckbox.checked;
      const stockMode = stockFilter.value;

      let filtered = connectorData.filter(item => {
        if (search) {
          const haystack = normalize([
            item.partNumber,
            item.description,
            item.altNumber,
            item.vehicle,
            item.shop,
            item.van,
            item.manufacturer,
            item.gender,
            item.terminalSizes,
            item.passNumber
          ].join(" "));
          if (!haystack.includes(search)) return false;
        }

        if (catsSelected.length) {
          const catNorm = normalize(item.category);
          if (!catsSelected.includes(catNorm)) return false;
        }

        if (pinsSelected.length) {
          const pinsStr = String(item.pins ?? "");
          if (!pinsSelected.includes(pinsStr)) return false;
        }

        if (gendersSelected.length) {
          const gNorm = normalize(item.gender);
          if (!gendersSelected.includes(gNorm)) return false;
        }

        if (termSizesSelected.length) {
          const tsRaw = String(item.terminalSizes || "");
          const tokens = tsRaw.split(/\s+/).filter(Boolean);
          if (!tokens.some(t => termSizesSelected.includes(t))) return false;
        }

        if (loc) {
          const combinedLoc = normalize(item.shop + " " + item.van);
          if (!combinedLoc.includes(loc)) return false;
        }

        if (mfrSelected.length) {
          const mfNorm = normalize(item.manufacturer);
          if (!mfrSelected.includes(mfNorm)) return false;
        }

        if (oemSelected.length) {
          const vehNorm = normalize(item.vehicle);
          if (!oemSelected.some(o => vehNorm.includes(o))) return false;
        }

        if (stockMode === "shop") {
          if (!((Number(item.shopQty) || 0) > 0)) return false;
        } else if (stockMode === "van") {
          if (!((Number(item.vanQty) || 0) > 0)) return false;
        }

        if (hasPic) {
          if (!(item.picture && /^https?:\/\//.test(item.picture))) return false;
        }

        if (hasTerm) {
          const d = item.details || {};
          const hasT =
            (d.terminal1 && String(d.terminal1).trim() !== "") ||
            (d.terminal2 && String(d.terminal2).trim() !== "");
          if (!hasT) return false;
        }

        return true;
      });

      filtered.sort((a, b) => {
        const { key, dir } = currentSort;
        let va = a[key], vb = b[key];

        if (key === "pins") {
          va = Number(va) || 0;
          vb = Number(vb) || 0;
        } else {
          va = String(va || "").toLowerCase();
          vb = String(vb || "").toLowerCase();
        }

        if (va < vb) return dir === "asc" ? -1 : 1;
        if (va > vb) return dir === "asc" ? 1 : -1;
        return 0;
      });

      filteredData = filtered;
      currentPage = 1;
      renderPagedResults();
      saveFilters();
    }

    function createDetailsGrid(details) {
      const grid = document.createElement("div");
      grid.className = "details-grid";

      const makeBlock = (title, main, sub) => {
        if (!main && !sub) return null;
        const block = document.createElement("div");
        block.className = "details-term-block";

        const titleEl = document.createElement("div");
        titleEl.className = "details-term-title";
        titleEl.textContent = title;

        const mainEl = document.createElement("div");
        mainEl.className = "details-term-main";
        mainEl.textContent = main || "";

        const subEl = document.createElement("div");
        subEl.className = "details-term-sub";
        subEl.textContent = sub || "";

        block.appendChild(titleEl);
        if (main) block.appendChild(mainEl);
        if (sub) block.appendChild(subEl);

        return block;
      };

      const t1Sub = [details.terminal1Tub, details.terminal1Range]
        .filter(Boolean)
        .join("  ·  ");
      const t1 = makeBlock("TERMINAL 1", details.terminal1Code, t1Sub);

      const t2Sub = [details.terminal2Tub, details.terminal2Range]
        .filter(Boolean)
        .join("  ·  ");
      const t2 = makeBlock("TERMINAL 2", details.terminal2Code, t2Sub);

      const mating = makeBlock("MATING", details.mating || "", "");

      let priceText = "";
      if (typeof details.price === "number") {
        priceText = `$${details.price.toFixed(2)}`;
      } else if (details.price) {
        priceText = String(details.price);
      }
      const price = makeBlock("PRICE", priceText, "");

      const alt = makeBlock("ALT NUMBER", details.altNumber || "", "");

      [t1, t2, mating, price, alt].forEach((b) => b && grid.appendChild(b));

      const ford = makeBlock("FORD", details.ford || "", "");
      const gm = makeBlock("GM", details.gm || "", "");
      const hk = makeBlock("HYUNDAI/KIA", details.hyundaiKia || "", "");
      const nissan = makeBlock("NISSAN", details.nissan || "", "");
      const toyota = makeBlock("TOYOTA", details.toyota || "", "");
      [ford, gm, hk, nissan, toyota].forEach((b) => b && grid.appendChild(b));

      if (!grid.children.length) {
        const empty = document.createElement("div");
        empty.className = "details-item-sub";
        empty.textContent = "No extra details.";
        grid.appendChild(empty);
      }

      return grid;
    }

    function clearSelection() {
      selectedItem = null;
      selectedPartSpan.textContent = "(none)";
      actionSelect.value = "";
      actionStatus.textContent = "";
      actionBar.style.display = "none";

      document.querySelectorAll(".data-row.selected-row").forEach(r => {
        r.classList.remove("selected-row");
      });

      if (openDetailsRow) {
        openDetailsRow.style.display = "none";
        openDetailsRow = null;
      }
      if (openExpander) {
        openExpander.textContent = "▸";
        openExpander = null;
      }
    }

    function selectItem(item, rowEl) {
      selectedItem = item;
      selectedPartSpan.textContent = item.partNumber || "(no part #)";
      actionBar.style.display = "flex";
      actionStatus.textContent = "";

      document.querySelectorAll(".data-row.selected-row").forEach(r => {
        r.classList.remove("selected-row");
      });
      if (rowEl) {
        rowEl.classList.add("selected-row");
      }
    }

    function renderResults(pageItems) {
      resultsBody.innerHTML = "";

      if (!pageItems.length) {
        const row = document.createElement("tr");
        const cell = document.createElement("td");
        cell.colSpan = 12;
        cell.className = "muted";
        cell.textContent = "No matching connectors.";
        row.appendChild(cell);
        resultsBody.appendChild(row);
        return;
      }

      pageItems.forEach((item) => {
        const tr = document.createElement("tr");
        tr.className = "data-row";

        const tdExp = document.createElement("td");
        const exp = document.createElement("span");
        exp.className = "expander";
        exp.textContent = "▸";
        tdExp.appendChild(exp);
        tr.appendChild(tdExp);

        const tdPic = document.createElement("td");

        if (item.picture && /^https?:\/\//.test(item.picture)) {
          const img = document.createElement("img");

          const proxiedUrl = `/.netlify/functions/image-proxy?url=${encodeURIComponent(
            item.picture
          )}`;

          img.src = proxiedUrl;
          img.alt = item.partNumber || "Connector";
          img.className = "thumb-img";

          img.addEventListener("click", (e) => {
            e.stopPropagation();
            window.open(item.picture, "_blank");
          });

          img.onerror = () => {
            img.src = "";
            img.alt = "No image";
            tdPic.innerHTML = '<span class="muted">—</span>';
          };

          tdPic.appendChild(img);
        } else {
          tdPic.innerHTML = '<span class="muted">—</span>';
        }

        tr.appendChild(tdPic);

        const tdPart = document.createElement("td");
        tdPart.textContent = item.partNumber || "";
        tr.appendChild(tdPart);

        const tdDesc = document.createElement("td");
        tdDesc.textContent = item.description || "";
        tr.appendChild(tdDesc);

        const tdShop = document.createElement("td");
        tdShop.textContent = item.shop || "";
        tdShop.className = "shop-cell";
        tr.appendChild(tdShop);

        const tdShopQty = document.createElement("td");
        const shopPill = document.createElement("span");
        shopPill.className = `qty-pill ${qtyClass(item.shopQty)}`;
        shopPill.textContent = item.shopQty;
        tdShopQty.appendChild(shopPill);
        tdShopQty.className = "shop-qty";
        tr.appendChild(tdShopQty);

        const tdVan = document.createElement("td");
        tdVan.textContent = item.van || "";
        tdVan.className = "van-cell";
        tr.appendChild(tdVan);

        const tdVanQty = document.createElement("td");
        const vanPill = document.createElement("span");
        const vanQty = item.vanQty;
        vanPill.className = `qty-pill ${qtyClass(vanQty)}`;
        vanPill.textContent = vanQty;
        tdVanQty.appendChild(vanPill);
        tdVanQty.className = "van-qty";
        tr.appendChild(tdVanQty);

        const tdPins = document.createElement("td");
        tdPins.textContent = item.pins || "";
        tr.appendChild(tdPins);

        const tdType = document.createElement("td");
        const tag = document.createElement("span");
        tag.className = "tag";
        tag.textContent = item.category || "N/A";
        tdType.appendChild(tag);
        tr.appendChild(tdType);

        const tdGender = document.createElement("td");
        const g = String(item.gender || "").toLowerCase();
        tdGender.textContent = g === "female" ? "F" : g === "male" ? "M" : "";
        tr.appendChild(tdGender);

        const tdMfr = document.createElement("td");
        tdMfr.textContent = item.manufacturer || "";
        tr.appendChild(tdMfr);

        const detailsTr = document.createElement("tr");
        detailsTr.className = "details-row";
        detailsTr.style.display = "none";

        const detailsTd = document.createElement("td");
        detailsTd.colSpan = 12;
        detailsTd.className = "details-cell";

        const detailsGrid = createDetailsGrid(item.details || {}, item.altNumber);
        detailsTd.appendChild(detailsGrid);
        detailsTr.appendChild(detailsTd);

        const toggle = () => {
          const isOpen = detailsTr.style.display !== "none";
          if (!isOpen) {
            if (openDetailsRow && openDetailsRow !== detailsTr) {
              openDetailsRow.style.display = "none";
            }
            if (openExpander && openExpander !== exp) {
              openExpander.textContent = "▸";
            }
            detailsTr.style.display = "";
            exp.textContent = "▾";
            openDetailsRow = detailsTr;
            openExpander = exp;
          } else {
            detailsTr.style.display = "none";
            exp.textContent = "▸";
            openDetailsRow = null;
            openExpander = null;
          }
        };

        exp.addEventListener("click", e => {
          e.stopPropagation();
          toggle();
          selectItem(item, tr);
        });

        tr.addEventListener("click", () => {
          toggle();
          selectItem(item, tr);
        });

        resultsBody.appendChild(tr);
        resultsBody.appendChild(detailsTr);
      });
    }

    function renderPagedResults() {
      const total = filteredData.length;
      const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));

      if (total === 0) {
        renderResults([]);
        resultsCount.textContent = "Showing 0 items";
        pageInfo.textContent = "Page 0 of 0 · 0 items";
        prevPageBtn.disabled = true;
        nextPageBtn.disabled = true;
        return;
      }

      if (currentPage > totalPages) currentPage = totalPages;
      const start = (currentPage - 1) * PAGE_SIZE;
      const pageItems = filteredData.slice(start, start + PAGE_SIZE);

      renderResults(pageItems);

      resultsCount.textContent = `Showing ${total} item${total !== 1 ? "s" : ""}`;
      pageInfo.textContent = `Page ${currentPage} of ${totalPages} · ${total} item${total !== 1 ? "s" : ""}`;
      prevPageBtn.disabled = currentPage <= 1;
      nextPageBtn.disabled = currentPage >= totalPages;
    }

    function closeAllMultiMenus() {
      document.querySelectorAll(".multi-select").forEach(el => el.classList.remove("open"));
      document.querySelectorAll(".multi-select-menu").forEach(el => el.classList.remove("open"));
    }

    function wireMultiDropdowns() {
      const toggles = document.querySelectorAll(".multi-select");
      toggles.forEach(toggle => {
        const filterName = toggle.getAttribute("data-filter-toggle");
        toggle.addEventListener("click", (e) => {
          e.stopPropagation();
          const isOpen = toggle.classList.contains("open");
          closeAllMultiMenus();
          if (!isOpen) {
            toggle.classList.add("open");
            const menu =
              document.querySelector(`.multi-select-menu[data-filter-menu="${filterName}"]`);
            if (menu) menu.classList.add("open");
          }
        });
      });

      document.querySelectorAll(".multi-select-menu").forEach(menu => {
        menu.addEventListener("click", (e) => {
          e.stopPropagation();
        });
      });

      document.addEventListener("click", () => {
        closeAllMultiMenus();
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          closeAllMultiMenus();
        }
      });
    }

    function wireMultiCheckboxes() {
      document.querySelectorAll(".multi-select-menu").forEach(menu => {
        const filterName = menu.getAttribute("data-filter-menu");

        menu.querySelectorAll('input[type="checkbox"]').forEach(cb => {
          cb.addEventListener("change", () => {
            const val = cb.value;
            const set = multiState[filterName];
            if (!set) return;
            if (cb.checked) {
              set.add(val);
            } else {
              set.delete(val);
            }
            updateMultiLabel(filterName);
            applyFilters();
          });
        });

        const clearBtn = menu.querySelector(".multi-select-clear");
        if (clearBtn) {
          clearBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            clearMultiSelect(filterName);
            applyFilters();
          });
        }
      });
    }

    function clearMultiSelect(filterName) {
      const set = multiState[filterName];
      if (!set) return;
      set.clear();

      const menu =
        document.querySelector(`.multi-select-menu[data-filter-menu="${filterName}"]`);
      if (menu) {
        menu.querySelectorAll('input[type="checkbox"]').forEach(cb => {
          cb.checked = false;
        });
      }
      updateMultiLabel(filterName);
    }

    function clearAllMultiSelects() {
      Object.keys(multiState).forEach(key => {
        clearMultiSelect(key);
      });
    }

    function restoreFilters() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          applyFilters();
          return;
        }
        const state = JSON.parse(raw);

        searchInput.value = state.search || "";
        locationFilter.value = state.location || "";

        if (state.multi && typeof state.multi === "object") {
          Object.keys(multiState).forEach(filterName => {
            const values = state.multi[filterName];
            if (!Array.isArray(values)) return;
            const set = new Set(values);
            multiState[filterName] = set;

            const menu =
              document.querySelector(`.multi-select-menu[data-filter-menu="${filterName}"]`);
            if (menu) {
              menu.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = set.has(cb.value);
              });
            }
            updateMultiLabel(filterName);
          });
        }

        hasPictureCheckbox.checked = !!state.hasPicture;
        hasTerminalsCheckbox.checked = !!state.hasTerminals;
        stockFilter.value = state.stockFilter || "";

        applyFilters();
      } catch (e) {
        applyFilters();
      }
    }

    function debounce(fn, delay) {
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn(...args), delay);
      };
    }

    function requireInventoryCode() {
  const code = window.prompt("Enter access code to modify inventory:");

  if (code === null) {
    // User hit Cancel
    return false;
  }

  if (code.trim() === "1575") {
    return true;
  }

  alert("Incorrect code.");
  return false;
}


    async function loadData() {
      try {
        resultsCount.textContent = "Loading inventory…";
        const res = await fetch(DATA_URL);
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        if (!data || !Array.isArray(data.items)) {
          throw new Error("Unexpected response from server");
        }

        connectorData = data.items;

        if (Array.isArray(data.pinOptions)) {
          const pinsMenu =
            document.querySelector('.multi-select-menu[data-filter-menu="pins"]');
          if (pinsMenu) {
            const header = pinsMenu.querySelector(".multi-select-menu-header");
            pinsMenu.innerHTML = "";
            if (header) pinsMenu.appendChild(header);
            const pinsSorted = [...data.pinOptions].sort((a, b) => {
              const na = Number(a), nb = Number(b);
              if (!isNaN(na) && !isNaN(nb)) return na - nb;
              return String(a).localeCompare(String(b));
            });
            pinsSorted.forEach(val => {
              if (!val) return;
              const label = document.createElement("label");
              const cb = document.createElement("input");
              cb.type = "checkbox";
              cb.value = val;
              label.appendChild(cb);
              label.appendChild(document.createTextNode(" " + val));
              pinsMenu.appendChild(label);
            });
          }
        }

        if (Array.isArray(data.manufacturerOptions)) {
          const mMenu =
            document.querySelector('.multi-select-menu[data-filter-menu="manufacturer"]');
          if (mMenu) {
            const header = mMenu.querySelector(".multi-select-menu-header");
            mMenu.innerHTML = "";
            if (header) mMenu.appendChild(header);
            const mfrSorted = [...data.manufacturerOptions].sort((a, b) =>
              String(a).localeCompare(String(b))
            );
            mfrSorted.forEach(val => {
              if (!val) return;
              const label = document.createElement("label");
              const cb = document.createElement("input");
              cb.type = "checkbox";
              cb.value = val;
              label.appendChild(cb);
              label.appendChild(document.createTextNode(" " + val));
              mMenu.appendChild(label);
            });
          }
        }

        if (Array.isArray(data.termSizeOptions)) {
          const tMenu =
            document.querySelector('.multi-select-menu[data-filter-menu="termSize"]');
          if (tMenu) {
            const header = tMenu.querySelector(".multi-select-menu-header");
            tMenu.innerHTML = "";
            if (header) tMenu.appendChild(header);
            const tSorted = [...data.termSizeOptions]
              .filter(Boolean)
              .sort((a, b) => String(a).localeCompare(String(b), undefined, { numeric: true }));
            tSorted.forEach(val => {
              const label = document.createElement("label");
              const cb = document.createElement("input");
              cb.type = "checkbox";
              cb.value = val;
              label.appendChild(cb);
              label.appendChild(document.createTextNode(" " + val));
              tMenu.appendChild(label);
            });
          }
        }

        wireMultiCheckboxes();
        restoreFilters();
      } catch (err) {
        console.error(err);
        resultsBody.innerHTML = "";
        const row = document.createElement("tr");
        const cell = document.createElement("td");
        cell.colSpan = 12;
        cell.className = "muted";
        cell.textContent = "Error loading data: " + (err.message || "Unknown error");
        row.appendChild(cell);
        resultsBody.appendChild(row);
        resultsCount.textContent = "Error loading inventory";
      }
    }

    /* ---------- VIN helpers ---------- */

    function isPotentialVin(str) {
      if (!str) return false;
      const trimmed = String(str).replace(/\s+/g, "").toUpperCase();
      return (
        trimmed.length === 17 &&
        !/[IOQ]/.test(trimmed) &&
        /^[A-Z0-9]+$/.test(trimmed)
      );
    }

    async function decodeVinIfNeeded(raw) {
      const trimmed = String(raw || "").replace(/\s+/g, "").toUpperCase();
      if (!isPotentialVin(trimmed)) {
        requestVinHint.textContent = "";
        return { vin: "", year: "", make: "", model: "", raw: raw || "" };
      }

      requestVinHint.textContent = "Detected 17-digit VIN.";
      // You can later add a fetch to NHTSA here for real decode.
      return { vin: trimmed, year: "", make: "", model: "", raw: raw || "" };
    }

    /* ---------- Chat senders ---------- */

    // Basic connector info → OnsitePASS Chat
    function sendRequestToChat(item) {
      actionStatus.textContent = "Sending request…";

      const params = new URLSearchParams({
        mode: "requestConnector",
        partNumber: item.partNumber || "",
        description: item.description || "",
        shop: item.shop || "",
        shopQty: String(item.shopQty ?? ""),
        van: item.van || "",
        vanQty: String(item.vanQty ?? ""),
        pins: String(item.pins ?? ""),
        category: item.category || "",
        manufacturer: item.manufacturer || "",
        passNumber: item.passNumber || "",
        source: "Connector Inventory Web"
      });

      params.append("ts", Date.now().toString());

      const url = REQUEST_URL + "?" + params.toString();

      let iframe = document.getElementById("requestFrame");
      if (!iframe) {
        iframe = document.createElement("iframe");
        iframe.id = "requestFrame";
        iframe.style.display = "none";
        document.body.appendChild(iframe);
      }

      iframe.src = url;
      actionStatus.textContent = "Request sent to Google Chat.";
    }

    // Detailed request (Requestor / Shop / VIN/YMM)
    async function sendDetailedRequestToChat(item) {
      const vinInfo = await decodeVinIfNeeded(requestVinOrYmmInput.value);

      const params = new URLSearchParams({
        mode: "requestConnectorDetailed",
        partNumber: item.partNumber || "",
        description: item.description || "",
        requestor: requestRequestorInput.value || "",
        shop: requestShopInput.value || "",
        vinOrYmm: requestVinOrYmmInput.value || "",
        vin: vinInfo.vin || "",
        year: vinInfo.year || "",
        make: vinInfo.make || "",
        model: vinInfo.model || "",
        source: "Connector Inventory Web"
      });

      params.append("ts", Date.now().toString());

      const url = REQUEST_URL + "?" + params.toString();

      let iframe = document.getElementById("requestFrame");
      if (!iframe) {
        iframe = document.createElement("iframe");
        iframe.id = "requestFrame";
        iframe.style.display = "none";
        document.body.appendChild(iframe);
      }

      iframe.src = url;
      actionStatus.textContent = "Request sent to Google Chat.";
    }

    /* ---------- Modals ---------- */

    function openRequestModal() {
      if (!selectedItem) return;
      requestPartNumberInput.value = selectedItem.partNumber || "";
      requestDescriptionInput.value = selectedItem.description || "";
      requestRequestorInput.value = "";
      requestShopInput.value = "";
      requestVinOrYmmInput.value = "";
      requestVinHint.textContent = "";
      requestModal.classList.add("open");
    }

    function closeRequestModal() {
      requestModal.classList.remove("open");
    }

    requestModalClose.addEventListener("click", closeRequestModal);
    requestModalSendBtn.addEventListener("click", () => {
      if (!selectedItem) return;
      sendDetailedRequestToChat(selectedItem);
      closeRequestModal();
    });

    function buildInventoryForm(item, mode) {
      inventoryModalBody.innerHTML = "";

      const data = item || {};

      const fields = [
        { key: "shopQty", label: "Shop Qty", value: data.shopQty ?? "", type: "number" },
        { key: "vanQty", label: "Van Qty", value: data.vanQty ?? "", type: "number" },
        { key: "shop", label: "Shop Location", value: data.shop || "", type: "text" },
        { key: "van", label: "Van Location", value: data.van || "", type: "text" },
        { key: "partNumber", label: "Part #", value: data.partNumber || "", type: "text" },
        { key: "description", label: "Description", value: data.description || "", type: "text" },
        { key: "altNumber", label: "Alt Number", value: data.altNumber || "", type: "text" },
        { key: "pins", label: "Pin Count", value: data.pins || "", type: "text" },
        { key: "category", label: "Type", value: data.category || "", type: "text" },
        { key: "gender", label: "Gender", value: data.gender || "", type: "text" },
        { key: "manufacturer", label: "Supplier", value: data.manufacturer || "", type: "text" },
        { key: "terminalSizes", label: "Terminal Sizes", value: data.terminalSizes || "", type: "text" }
      ];

      fields.forEach(f => {
        const wrapper = document.createElement("div");
        wrapper.className = "modal-field";

        const label = document.createElement("label");
        label.textContent = f.label;

        const current = document.createElement("div");
        current.style.fontSize = "0.72rem";
        current.style.color = "#6b7280";
        current.textContent =
          mode === "update" && data && data[f.key] !== undefined
            ? `Current: ${data[f.key]}`
            : (mode === "update" ? "Current: (blank)" : "");

        const input = document.createElement("input");
        input.type = f.type || "text";
        input.id = `inv_${f.key}`;
        input.value = mode === "update" ? "" : (f.value ?? "");

        wrapper.appendChild(label);
        if (mode === "update") wrapper.appendChild(current);
        wrapper.appendChild(input);

        inventoryModalBody.appendChild(wrapper);
      });
    }

    function openInventoryModal(mode) {
      if (mode === "update" && !selectedItem) return;

      const title = mode === "update" ? "Update Inventory" : "Add to Inventory";
      inventoryModalTitle.textContent = title;

      const itemForForm = mode === "update" ? selectedItem : {};
      buildInventoryForm(itemForForm, mode);

      inventoryModalSaveBtn.dataset.mode = mode;
      inventoryModal.classList.add("open");
    }

    function closeInventoryModal() {
      inventoryModal.classList.remove("open");
    }

    inventoryModalClose.addEventListener("click", closeInventoryModal);

    inventoryModalSaveBtn.addEventListener("click", () => {
      const mode = inventoryModalSaveBtn.dataset.mode || "update";

      const payload = {};
      const keys = [
        "shopQty",
        "vanQty",
        "shop",
        "van",
        "partNumber",
        "description",
        "altNumber",
        "pins",
        "category",
        "gender",
        "manufacturer",
        "terminalSizes"
      ];

      keys.forEach(k => {
        const input = document.getElementById(`inv_${k}`);
        if (!input) return;
        const val = input.value;
        if (val !== "") {
          payload[k] = val;
        }
      });

      if (mode === "update" && selectedItem) {
        payload.originalPartNumber = selectedItem.partNumber || "";
      }

      const params = new URLSearchParams();
      params.append("mode", mode === "update" ? "updateInventory" : "addInventory");
      params.append("source", "Connector Inventory Web");
      params.append("data", JSON.stringify(payload));
      params.append("ts", Date.now().toString());

      const url = REQUEST_URL + "?" + params.toString();

      let iframe = document.getElementById("requestFrame");
      if (!iframe) {
        iframe = document.createElement("iframe");
        iframe.id = "requestFrame";
        iframe.style.display = "none";
        document.body.appendChild(iframe);
      }

      iframe.src = url;
      actionStatus.textContent =
        mode === "update" ? "Inventory update sent." : "Add-to-inventory sent.";

      closeInventoryModal();
    });

    /* ---------- Actions / events ---------- */

    closeActionBarBtn.addEventListener("click", clearSelection);

    const debouncedApply = debounce(applyFilters, 250);
    searchInput.addEventListener("input", debouncedApply);
    locationFilter.addEventListener("input", applyFilters);
    hasPictureCheckbox.addEventListener("change", applyFilters);
    hasTerminalsCheckbox.addEventListener("change", applyFilters);
    stockFilter.addEventListener("change", applyFilters);

    clearSearchBtn.addEventListener("click", () => {
      searchInput.value = "";
      searchInput.focus();
      applyFilters();
    });

    resetFiltersBtn.addEventListener("click", () => {
      searchInput.value = "";
      locationFilter.value = "";
      hasPictureCheckbox.checked = false;
      hasTerminalsCheckbox.checked = false;
      stockFilter.value = "";
      clearAllMultiSelects();
      applyFilters();
      clearSelection();
    });

    document.querySelectorAll("th.sortable").forEach(th => {
      th.addEventListener("click", () => {
        const key = th.dataset.sort;
        if (currentSort.key === key) {
          currentSort.dir = currentSort.dir === "asc" ? "desc" : "asc";
        } else {
          currentSort.key = key;
          currentSort.dir = "asc";
        }
        applyFilters();
      });
    });

    prevPageBtn.addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        renderPagedResults();
      }
    });

    nextPageBtn.addEventListener("click", () => {
      const totalPages = Math.max(1, Math.ceil(filteredData.length / PAGE_SIZE));
      if (currentPage < totalPages) {
        currentPage++;
        renderPagedResults();
      }
    });

    runActionBtn.addEventListener("click", () => {
      if (!selectedItem) {
        actionStatus.textContent = "Select a connector first.";
        return;
      }

      const action = actionSelect.value;
      if (!action) {
        actionStatus.textContent = "Choose an action.";
        return;
      }

      if (action === "sendInfo") {
        sendRequestToChat(selectedItem);
      } else if (action === "requestConnector") {
        openRequestModal();
      } else if (action === "copyPart") {
        const part = selectedItem.partNumber || "";
        if (!part) {
          actionStatus.textContent = "No part # to copy.";
          return;
        }

        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(part)
            .then(() => {
              actionStatus.textContent = `Part # ${part} copied.`;
            })
            .catch(() => {
              const temp = document.createElement("input");
              temp.value = part;
              document.body.appendChild(temp);
              temp.select();
              try {
                document.execCommand("copy");
                actionStatus.textContent = `Part # ${part} copied.`;
              } catch (e) {
                actionStatus.textContent = "Unable to copy part #.";
              }
              document.body.removeChild(temp);
            });
        } else {
          const temp = document.createElement("input");
          temp.value = part;
          document.body.appendChild(temp);
          temp.select();
          try {
            document.execCommand("copy");
            actionStatus.textContent = `Part # ${part} copied.`;
          } catch (e) {
            actionStatus.textContent = "Unable to copy part #.";
          }
          document.body.removeChild(temp);
        }
      } else if (action === "updateInventory") {
        if (!requireInventoryCode()) return;
        openInventoryModal("update", selectedItem);
      } else if (action === "addInventory") {
        if (!requireInventoryCode()) return;
        openInventoryModal("add", selectedItem);
      }
    });

    wireMultiDropdowns();
    loadData();
  </script>
  <script>
  const current = window.location.pathname.replace("/", "");
  document.querySelectorAll(".top-nav .nav-item").forEach(link => {
    const href = link.getAttribute("href").replace("/", "");
    if (href === current || (href === "index.html" && current === "")) {
      link.classList.add("active");
    }
  });
</script>

</body>
</html>
